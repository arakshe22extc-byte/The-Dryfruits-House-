document.addEventListener('DOMContentLoaded', function() {
    const orderItems = document.getElementById('order-items');
    const orderTotal = document.getElementById('order-total');
    const orderForm = document.getElementById('order-form');

    // Start with empty cart
    let cart = [];

    // Only fetch cart from localStorage if products were added JUST NOW
    const savedCart = JSON.parse(localStorage.getItem('currentCart')) || [];
    if(savedCart.length > 0){
        cart = savedCart;  // populate only current session cart
        localStorage.removeItem('currentCart'); // clear temp cart
    }

    function displayOrder() {
        orderItems.innerHTML = '';
        let total = 0;
        if(cart.length === 0){
            orderItems.innerHTML = '<tr><td colspan="4">Your cart is empty!</td></tr>';
        } else {
            cart.forEach(item => {
                const tr = document.createElement('tr');
                const subtotal = item.price * item.quantity;
                tr.innerHTML = `<td>${item.name}</td><td>${item.quantity}</td><td>${item.price}</td><td>${subtotal}</td>`;
                orderItems.appendChild(tr);
                total += subtotal;
            });
        }
        orderTotal.textContent = total;
    }

    displayOrder();

    orderForm.addEventListener('submit', function(e){
        e.preventDefault();
        if(cart.length === 0){ alert("Cart empty! Add products first."); return; }
        const name = document.getElementById('name').value;
        const contact = document.getElementById('contact').value;
        const address = document.getElementById('address').value;
        const payment = document.getElementById('payment').value;

        let orderDetails = `New Order from ${name}\nContact: ${contact}\nAddress: ${address}\nPayment: ${payment}\n\nProducts:\n`;
        cart.forEach(item => { orderDetails += `${item.name} x ${item.quantity} = ₹${item.price * item.quantity}\n`; });
        orderDetails += `\nTotal Amount: ₹${orderTotal.textContent}`;

        window.location.href = `mailto:yourmail@example.com?subject=New Order&body=${encodeURIComponent(orderDetails)}`;

        cart = [];
        displayOrder();
        orderForm.reset();
    });
});
